function Bengine(e,t){var n={},i={},a={};if(i.variables={},this.variables=i.variables,i.variables.qengine={},i.variables.qengine.randomseed=Math.floor(4294967296*Math.random()),i.options={},"object"!=typeof e)var o={};else o=Object.assign({},e);if(i.options.blockLimit=o.blockLimit||16,i.options.defaultText=!1!==o.defaultText,i.options.enableAutoSave=o.enableSave||!1,i.options.enableSingleView=o.enableSingleView||!1,i.options.localMode=o.localMode||!1,i.options.mediaLimit=o.mediaLimit||100,i.options.mode=o.mode||"bengine",i.options.playableMediaLimit=o.playableMediaLimit||180,a.categoryCounts={media:0,text:0,quiz:0,unknown:0},a.engineID="",a.pagePath="",a.quizData={data:{},grade:null,stepConditional:"",stepCurrent:0,stepNext:null,submitData:{},store:[]},i.getEngineID=function(){return a.engineID},i.getPagePath=function(){return a.pagePath},a.blockMethod={},a.extAPI={},a.datahandler={},a.helper={},"object"!=typeof Bengine.extensibles)throw Error("Bengine.extensibles must be an object.");a.extensibles=Object.assign({},Bengine.extensibles);var l=["type","name","category","upload","accept","destroy","fetchDependencies","insertContent","afterDOMinsert","runBlock","runData","saveContent","saveFile","showContent","styleBlock"];for(var s in a.extensibles)!function(e){var t=Object.keys(a.extensibles[e]);if(l.forEach(function(n){t.includes(n)||(a.extensibles[e][n]=null,console.warn("Bengine: "+e+" has not implemented method: "+n))}),a.extensibles.hasOwnProperty(e))switch(a.extensibles[e].category){case"media":a.categoryCounts.media++;break;case"text":a.categoryCounts.text++;break;case"quiz":a.categoryCounts.quiz++;break;default:throw new Error("Invalid Category In Extensibles")}a.extensibles[e].p=a.extAPI,a.extensibles[e].d=i}(s);a.blockMethod.unknownBlock=function(e){this.type=e,this.name=e,this.category="unknown",this.upload=!1,this.accept=null,this.destroy=function(){return null},this.fetchDependencies=function(){return null},this.insertContent=function(e,t){return e.innerHTML="<p class='bengine_unknown_block'>unknown block</p>",e},this.afterDOMinsert=function(e,t,n){return null},this.runBlock=null,this.runData=function(e){return null},this.saveContent=function(e){return{}},this.showContent=function(e,t){return e.innerHTML="unknown block",e},this.styleBlock=function(){return""}},"object"!=typeof t&&(t={alerts:null,display:null}),"object"!=typeof t.alerts||null===t.alerts?a.alerts={alert:function(e){window.alert(e)},confirm:function(e){window.confirm(e)},log:function(e){console.log(e)}}:a.alerts=Object.assign({},t.alerts);var r=Object.keys(a.alerts);["alert","confirm","log"].forEach(function(e){if(!r.includes(e))throw Error("Bengine: invalid alerts configuration. Missing method: "+e)}),"function"!=typeof t.display||null===t.display?(a.displayClass=function(e){this.engineID=e},a.displayClass.prototype.progressFinalize=function(){},a.displayClass.prototype.progressInitialize=function(){},a.displayClass.prototype.progressUpdate=function(){},a.displayClass.prototype.updateSaveStatus=function(){}):a.displayClass=t.display;var c=Object.keys(a.displayClass.prototype);function d(e){var t={},n=this;t.data={cblock:""},n.data={blocks:{},order:[]},t.reset=function(){t.data={cblock:""},n.data={blocks:{},order:[]}},t.parseOpen=function(e){var n=e.split("{%");if(n.length>1){var i,a,o=null,l="",s=n[1].split(":");if(s.length>2){a=s[0],i=s[1],o=(r=s[2].split(/\s/g))[0],r.length>1&&(l=r[1])}else{if(!(s.length>1))throw"Invalid Engine File";var r;a=s[0],i=(r=s[1].split(/\s/g))[0],r.length>1&&(l=r[1])}return t.createBlock(i,a,o),l&&t.parseClose(l),!0}return!1},t.parseClose=function(e){var n=e.split("%}");return n.length>1?(t.addToBlock(n[0]),!t.parseOpen(n[1])):(t.addToBlock(e),!1)},t.createBlock=function(e,i,a){n.data.blocks[e]=[i,"",a],n.data.order.push(e),t.data.cblock=e},t.addToBlock=function(e){n.data.blocks[t.data.cblock][1]+=e},n.parseEngineFile=function(e){t.reset();var i=!0,a=e.split("\n");for(line of a)i=i?!t.parseOpen(line):t.parseClose(line);return n.data}}["progressFinalize","progressInitialize","progressUpdate","updateSaveStatus"].forEach(function(e){if(!c.includes(e))throw Error("Bengine: invalid display configuration in. Missing method: "+e)}),function(){if(null===document.getElementById("bengine-global-styles")){var e=document.createElement("style");e.id="bengine-global-styles",e.type="text/css",e.innerHTML="\n.bengine-instance{height:100%}.bengine-block-style-embed{height:85vh!important;margin:0!important}.bengine-x-blocks{height:100%}.bengine-single-view{width:100%;height:15vh;position:absolute;bottom:0;right:0}.bengine-btn-embed{border:0;color:#000;float:left;width:100%;height:100%;padding:0 30px;text-align:center;cursor:pointer;transition:background-color .5s;touch-action:manipulation;font-size:1em;font-weight:400}.bengine-btn-color{background-color:#000;color:#fff;font-size:1.3em}.bengine-btn-color:hover{background-color:rgba(0,0,0,.6);color:#000}.bengine-block{margin:0;padding:0}.bengine-blockbtns{margin:50px auto 0 auto;position:relative}.bengine-blockbtn{color:#000;border:1px solid #000;width:100%;padding:6px 12px;text-align:center;cursor:pointer;transition:background-color .5s;touch-action:manipulation;font-size:1em;font-weight:400}.bengine-addbtn{background-color:#fff}.bengine-addbtn:hover{background-color:#d3d3d3}.bengine-delbtn{background-color:#ff1818}.bengine-delbtn:hover{background-color:#a81313}.bengine-x-ns-cond{padding:5px 8px;border:1px solid #000;display:inline-block;box-sizing:border-box;font-size:.9em}.bengine_unknown_block{display:inline-block;width:100%;height:32px;border:1px solid #fff;padding:6px 6px;margin:0;box-sizing:border-box;text-align:center;font-family:Arial,Helvetica,sans-serif;font-size:1em;font-weight:700;color:#fff;background-color:#000}.bengine-iframe{overflow:hidden}@media screen and (max-width:900px){.bengine-blockbtns{width:100%}.bengine-blockbtn{width:100%}}.col{box-sizing:border-box;position:relative;float:left;min-height:1px;height:100%}.col-1{width:1%}.col-2{width:2%}.col-3{width:3%}.col-4{width:4%}.col-5{width:5%}.col-6{width:6%}.col-7{width:7%}.col-8{width:8%}.col-9{width:9%}.col-10{width:10%}.col-11{width:11%}.col-12{width:12%}.col-13{width:13%}.col-14{width:14%}.col-15{width:15%}.col-16{width:16%}.col-17{width:17%}.col-18{width:18%}.col-19{width:19%}.col-20{width:20%}.col-21{width:21%}.col-22{width:22%}.col-23{width:23%}.col-24{width:24%}.col-25{width:25%}.col-26{width:26%}.col-27{width:27%}.col-28{width:28%}.col-29{width:29%}.col-30{width:30%}.col-31{width:31%}.col-32{width:32%}.col-33{width:33%}.col-34{width:34%}.col-35{width:35%}.col-36{width:36%}.col-37{width:37%}.col-38{width:38%}.col-39{width:39%}.col-40{width:40%}.col-41{width:41%}.col-42{width:42%}.col-43{width:43%}.col-44{width:44%}.col-45{width:45%}.col-46{width:46%}.col-47{width:47%}.col-48{width:48%}.col-49{width:49%}.col-50{width:50%}.col-51{width:51%}.col-52{width:52%}.col-53{width:53%}.col-54{width:54%}.col-55{width:55%}.col-56{width:56%}.col-57{width:57%}.col-58{width:58%}.col-59{width:59%}.col-60{width:60%}.col-61{width:61%}.col-62{width:62%}.col-63{width:63%}.col-64{width:64%}.col-65{width:65%}.col-66{width:66%}.col-67{width:67%}.col-68{width:68%}.col-69{width:69%}.col-70{width:70%}.col-71{width:71%}.col-72{width:72%}.col-73{width:73%}.col-74{width:74%}.col-75{width:75%}.col-76{width:76%}.col-77{width:77%}.col-78{width:78%}.col-79{width:79%}.col-80{width:80%}.col-81{width:81%}.col-82{width:82%}.col-83{width:83%}.col-84{width:84%}.col-85{width:85%}.col-86{width:86%}.col-87{width:87%}.col-88{width:88%}.col-89{width:89%}.col-90{width:90%}.col-91{width:91%}.col-92{width:92%}.col-93{width:93%}.col-94{width:94%}.col-95{width:95%}.col-96{width:96%}.col-97{width:97%}.col-98{width:98%}.col-99{width:99%}.col-100{width:100%}.col-1_1{width:100%}.col-1_2{width:50%}.col-1_3{width:33.33%}.col-2_3{width:66.66%}.col-1_4{width:25%}.col-1_5{width:20%}.col-1_6{width:16.66%}.col-1_7{width:14.28%}.col-1_8{width:12.5%}.col-1_9{width:11.11%}.col-1_10{width:10%}.col-1_11{width:9.09%}.col-1_12{width:8.33%}\n\t\t",document.getElementsByTagName("head")[0].appendChild(e)}}(),a.helper.counter=function(e){return void 0===this.track||0===this.track?(this.track=1,1):e?(this.track=0,0):(this.track++,this.track)},a.helper.position=function(e){return void 0===this.prev?(this.prev=0,this.curr=e):0===e?(this.prev=0,this.curr=0):this.curr!==e&&(this.prev=this.curr,this.curr=e),[this.prev,this.curr]},a.helper.convertNjnFormatToPageDataArray=function(e){var t=[];for(block of e.order)t.push(e.blocks[block][0]),t.push({content:e.blocks[block][1],namespace:block,conditional:e.blocks[block][2]});return t},a.helper.emptyDiv=function(e){if("object"==typeof e)for(;e.hasChildNodes();)e.removeChild(e.lastChild)},a.helper.createURL=function(e){return window.location.origin+encodeURI(e)};var d=new d;a.helper.parseEngineFile=d.parseEngineFile,a.helper.retrieveResource=function(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.open("GET",a.helper.createURL(e),!0),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)switch(i.status){case 200:t({msg:"Success",status:200,data:{file:i.responseText}});break;case 404:n({msg:"File Not Found",status:404,data:{}});break;default:n({msg:"Unknown Error",status:i.status,data:{}})}},i.send()})},a.helper.sleep=function(e){return new Promise(t=>setTimeout(t,e))},a.extAPI.alerts=a.alerts,a.extAPI.checkConditional=function(e){var t=!0;return e.conditional&&(cparts=e.conditional.split("."),cparts[0]in i.variables&&cparts[1]in i.variables[cparts[0]]&&i.variables[cparts[0]][cparts[1]]||(t=!1)),t},a.extAPI.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},a.extAPI.decodeHTML=function(){var e=document.createElement("div");return function(t){return t&&"string"==typeof t&&(e.innerHTML=t,t=e.textContent,e.textContent=""),t}}(),a.extAPI.emptyObject=function(e){return 0===Object.keys(e).length&&e.constructor===Object},a.extAPI.getLocalResource=function(e,t){return new Promise(function(n,i){var a=new XMLHttpRequest;a.open("GET",window.location.origin+t),a.responseType="blob",a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&(200!==a.status?i(t):n(new File([a.response],e)))},a.send()})},a.extAPI.getResourcePath=function(e){let t,n=e.split(/\.(.+)/).filter(function(e){return 0!=e.length});try{t=i.variables[n[0]][n[1]]}catch(e){}return void 0===t&&a.alerts.log("Qengine resource not found: "+e,"error"),t},a.extAPI.replaceVars=function(e){let t=/@@(.*?)@@/g;var n,o=e;do{if(n=t.exec(e)){let e,t=n[1].split(".");try{e=i.variables[t[0]][t[1]]}catch(t){e="",a.alerts.log("Qengine variable not found: "+n[1],"error")}o=o.replace(n[0],e)}}while(n);return o},a.extAPI.sendData=function(e,t){return new Promise(function(n,i){var o=new XMLHttpRequest;o.open("POST",a.helper.createURL(e),!0),o.setRequestHeader("Content-type","application/json"),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE)switch(o.status){case 500:i({msg:"unknown",status:500,data:{}});break;case 0:i({msg:"unknown",status:0,data:{}});break;case 200:n(JSON.parse(o.responseText));break;default:i(JSON.parse(o.responseText))}},o.send(JSON.stringify(t))})},a.loadBlocksShowReady=async function(e){var t,n=document.getElementById(a.engineID);if("undefined"===n)return-1;n.innerHTML="",n.style.height="100%",(t=document.createElement("div")).setAttribute("class","bengine-instance"),t.setAttribute("id","bengine-instance-"+a.engineID),n.appendChild(t);var o=document.createElement("div");o.setAttribute("class","bengine-x-blocks"),o.setAttribute("id","bengine-x-blocks-"+a.engineID),o.innerHTML="<p style='color:white'>loading blocks...</p>",t.appendChild(o),a.blockMethod.blockStyle();var l=a.blockMethod.blockScripts();for(let e=0;e<l.length;e++)for(var s=0;void 0===window[l[e]];){if(s>100){console.log("Reached wait limit for script: "+l[e]);break}await a.helper.sleep(100),s++}var r=0,c=1,d=e.length;for(o.innerHTML="";r<d;){var u=a.blockMethod.generateBlock(c,e[r]);try{var p=a.extensibles[e[r]].showContent(u,e[r+1])}catch(t){let n=e[r];throw a.alerts.alert("Missing Block Dependency: "+n+". Check Console For More Information"),t}i.options.enableSingleView?p.children[0].className+=" bengine-block-style-embed":p.children[0].className+=" bengine-block-style";var b=document.createElement("div");b.setAttribute("class","bengine-block bengine-block-"+a.engineID),b.setAttribute("id","bengine-"+a.engineID+"-"+c),i.options.enableSingleView&&1!==c&&b.setAttribute("style","display:none;visibility:hidden;"),b.appendChild(p),o.appendChild(b),a.extensibles[e[r]].afterDOMinsert("bengine-a-"+a.engineID+"-"+c,null,null),r+=2,c++}if(i.options.enableSingleView){function h(e){var t=-1;e&&(t=1);var n=document.getElementById("bengine-currentBlock-"+a.engineID),i=Number(n.getAttribute("data-currentBlock")),o=i+t,l=document.getElementById("bengine-"+a.engineID+"-"+o);null!==l&&(document.getElementById("bengine-"+a.engineID+"-"+i).setAttribute("style","display:none;visibility:hidden;"),l.setAttribute("style","display:block;visibility:visible;"),n.setAttribute("data-currentBlock",o))}var g=document.createElement("div");g.setAttribute("id","bengine-single-view-"+a.engineID),g.setAttribute("class","bengine-single-view");var f=document.createElement("button");f.setAttribute("class","bengine-btn-embed bengine-btn-color"),f.setAttribute("style","width: 50%;"),f.innerHTML="&larr;",f.onclick=function(){h(!1)};var m=document.createElement("button");m.setAttribute("class","bengine-btn-embed bengine-btn-color"),m.setAttribute("style","width: 50%;"),m.innerHTML="&rarr;",m.onclick=function(){h(!0)};var y=document.createElement("div");y.setAttribute("id","bengine-currentBlock-"+a.engineID),y.setAttribute("data-currentBlock",1),y.setAttribute("style","display:none;visibility:hidden;"),g.appendChild(f),g.appendChild(m),g.appendChild(y),t.appendChild(g)}},n.loadBlocksShow=function(e,t,n=[]){try{if("string"!=typeof e)throw Error("Invalid engineID passed to loadBlocksShow()");if("string"!=typeof t)throw Error("Invalid pagePath passed to loadBlocksShow()");if(!Array.isArray(n))throw Error("pageData must be array passed to loadBlocksShow()")}catch(e){return a.alerts.alert(e.message),-1}(t=t.replace(/^\/(.+)?\/$/g,"$1"),a.engineID=e,a.pagePath=t,n.length<1&&t.length>0)?a.helper.retrieveResource("/content/"+t+"/bengine.json").then(function(e){dataObj=JSON.parse(e.data.file),rpageData=[];for(let e=0;e<dataObj.types.length;e++)rpageData.push(dataObj.types[e]),rpageData.push(dataObj.content[e]);"loading"!==document.readyState?a.loadBlocksShowReady(rpageData):window.addEventListener("DOMContentLoaded",function(){a.loadBlocksShowReady(rpageData)})},function(e){a.alerts.alert("Error: "+e.msg+" Status: "+e.status)}):"loading"!==document.readyState?a.loadBlocksShowReady(n):window.addEventListener("DOMContentLoaded",function(){a.loadBlocksShowReady(n)})},this.loadBlocksShow=n.loadBlocksShow,a.loadQuizShowReady=async function(e){var t=document.createElement("style");t.innerHTML="body, html { height: 100%; }",document.getElementsByTagName("head")[0].appendChild(t);var n,o=document.getElementById(a.engineID);if("undefined"===o)return-1;o.innerHTML="",o.style.height="100%",(n=document.createElement("div")).setAttribute("class","bengine-instance"),n.setAttribute("id","bengine-instance-"+a.engineID),o.appendChild(n);var l=document.createElement("div");l.setAttribute("class","bengine-x-blocks"),l.setAttribute("id","bengine-x-blocks-"+a.engineID),l.innerHTML="<p style='color:white'>loading blocks...</p>",n.appendChild(l);var s=a.blockMethod.blockScripts();for(let e=0;e<s.length;e++)for(var r=0;void 0===window[s[e]];){if(r>100){console.log("Reached wait limit for script: "+s[e]);break}await a.helper.sleep(100),r++}function c(){var e=document.createElement("iframe");e.setAttribute("class","col col-100 bengine-iframe"),e.setAttribute("style","visibility:hidden;display:none"),e.setAttribute("frameBorder","0"),this.iframe=e,this.setUp=function(e,t){e.innerHTML="",e.appendChild(this.iframe);var n=document.createElement("style");n.innerHTML=document.getElementById("bengine-global-styles").innerHTML,this.iframe.contentDocument.head.appendChild(n);var i=document.createElement("form");i.addEventListener("submit",t),this.iframe.contentDocument.body.appendChild(i)}}a.quizData.data=e;var d=new c;async function u(e,t,n,i){if(-1===n||n>=t.length)e.setAttribute("style","visibility:visible;display:block");else{for(var o=t[n],l=t[n+1],s=a.extensibles[o].runData(l,e,i),r=0;!i.done&&r<100;)await a.helper.sleep(50),r++;100===r&&a.alerts.log(o+" never completed.");var c=!1;switch(o){case"qstep":a.quizData.stepCurrent[0];"string"==typeof s&&(a.quizData.stepConditional=s),c=!0;break;case"qstore":"object"==typeof s&&"Array"===s.constructor.name&&(a.quizData.store=a.quizData.store.concat(s));break;case"qans":"number"==typeof s&&(a.quizData.grade=s)}(n+=2)+2<t.length-1?a.quizData.stepNext=n:a.quizData.stepNext=-1,c&&(n=-1),i.done=!1,u(e,t,n,i)}}d.setUp(l,function e(t){t.preventDefault();for(var n=0;n<t.srcElement.elements.length;n++){var o=t.srcElement.elements[n].name,s=t.srcElement.elements[n].value,r=o.split(".");a.quizData.submitData[r[0]]?a.quizData.submitData[r[0]][r[1]]=s:(a.quizData.submitData[r[0]]={},a.quizData.submitData[r[0]][r[1]]=s)}var d=!1;a.quizData.stepConditional?(r=a.quizData.stepConditional.split("."),a.quizData.submitData[r[0]]&&a.quizData.submitData[r[0]][r[1]]&&(d=!0)):d=!0;if(d){var p={};a.quizData.store.forEach(function(e){var t=e.split(".");p[t[0]]||(p[t[0]]={}),p[t[0]][t[1]]=i.variables[t[0]][t[1]]}),i.variables=Object.assign(p,a.quizData.submitData),a.quizData.submitData={},a.quizData.stepConditional="",a.quizData.stepCurrent=a.quizData.stepNext,a.quizData.stepNext=null,a.quizData.submitData={},a.quizData.store=[];var b=new c;b.setUp(l,e),u(b.iframe,a.quizData.data,a.quizData.stepCurrent,{done:!1})}return!1}),u(d.iframe,e,0,{done:!1})},n.loadQuizShow=function(e,t,n=[]){try{if("string"!=typeof e)throw Error("Invalid engineID passed to loadQuizShow()");if("string"!=typeof t)throw Error("Invalid pagePath passed to loadQuizShow()");if(!Array.isArray(n))throw Error("pageData must be array passed to loadQuizShow()")}catch(e){return a.alerts.alert(e.message),-1}(t=t.replace(/^\/(.+)?\/$/g,"$1"),a.engineID=e,a.pagePath=t,n.length<1&&t.length>0)?a.helper.retrieveResource("/content/"+t+"/bengine.json").then(function(e){dataObj=JSON.parse(e.data.file),rpageData=[];for(let e=0;e<dataObj.types.length;e++)rpageData.push(dataObj.types[e]),rpageData.push(dataObj.content[e]);"loading"!==document.readyState?a.loadQuizShowReady(rpageData):window.addEventListener("DOMContentLoaded",function(){a.loadQuizShowReady(rpageData)})},function(e){a.alerts.alert("Error: "+e.msg+" Status: "+e.status)}):"loading"!==document.readyState?a.loadQuizShowReady(n):window.addEventListener("DOMContentLoaded",function(){a.loadQuizShowReady(n)})},this.loadQuizShow=n.loadQuizShow,a.loadBlocksEditReady=async function(e){a.status=1;var t,n=document.getElementById(a.engineID);if(null===n)return-1;n.innerHTML="",n.style.height="100%",a.display=new a.displayClass(a.engineID,a.datahandler),(t=document.createElement("div")).setAttribute("class","bengine-instance"),t.setAttribute("id","bengine-instance-"+a.engineID),n.appendChild(t);var i=document.createElement("div");i.setAttribute("class","bengine-x-blocks"),i.setAttribute("id","bengine-x-blocks-"+a.engineID),i.innerHTML="<p style='color:white'>loading blocks...</p>",t.appendChild(i);for(var o=0;o<e.length;o+=2)void 0===a.extensibles[e[o]]&&(a.categoryCounts.unknown+=1,a.extensibles[e[o]]=new a.blockMethod.unknownBlock(e[o]));a.blockMethod.blockStyle();var l=a.blockMethod.blockScripts();for(let e=0;e<l.length;e++)for(var s=0;void 0===window[l[e]];){if(s>100){console.log("Reached wait limit for script: "+l[e]);break}await a.helper.sleep(100),s++}i.innerHTML="";var r=a.blockMethod.blockButtons(0);r.childNodes.length;i.appendChild(r);var c=0,d=(o=1,e.length);r.childNodes[0].lastChild.children[0].style.visibility=d<2?"hidden":"visible";var u=0;for(Object.keys(a.categoryCounts).forEach(function(e){0!==a.categoryCounts[e]&&(u+=1)});c<d;){var p=a.blockMethod.generateBlock(o,e[c]),b=a.extensibles[e[c]].insertContent(p,e[c+1]);b=a.blockMethod.addRunBtn(o,a.extensibles[e[c]],b),(r=a.blockMethod.blockButtons(o)).childNodes[0].children[u].children[0].style.visibility=c===d-2?"hidden":"visible";var h=document.createElement("div");h.setAttribute("class","bengine-block bengine-block-"+a.engineID),h.setAttribute("id","bengine-"+a.engineID+"-"+o),h.appendChild(b),h.appendChild(r),i.appendChild(h),a.extensibles[e[c]].afterDOMinsert("bengine-a-"+a.engineID+"-"+o,null,null),c+=2,o++}var g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("id","bengine-file-select-"+a.engineID);var f=document.createElement("button");f.setAttribute("type","submit"),f.setAttribute("id","upload-button");var m=a.helper.createURL("/upload"),y=document.createElement("form");y.setAttribute("id","file-form-"+a.engineID),y.setAttribute("action",m),y.setAttribute("method","POST"),y.style.visibility="hidden",y.appendChild(g),y.appendChild(f),t.appendChild(y)},n.loadBlocksEdit=function(e,t,n=[]){try{if("string"!=typeof e)throw Error("Invalid engineID passed to blockEngineStart()");if("string"!=typeof t)throw Error("Invalid pagePath passed to blockEngineStart()");if(!Array.isArray(n))throw Error("pageData must be array passed to blockEngineStart()")}catch(e){return a.alerts.alert(e.message),-1}(t=t.replace(/^\/(.+)?\/$/g,"$1"),a.engineID=e,a.pagePath=t,n.length<1&&t.length>0)?a.helper.retrieveResource("/content/"+t+"/bengine.json").then(function(e){dataObj=JSON.parse(e.data.file),rpageData=[];for(let e=0;e<dataObj.types.length;e++)rpageData.push(dataObj.types[e]),rpageData.push(dataObj.content[e]);"loading"!==document.readyState?a.loadBlocksEditReady(rpageData):window.addEventListener("DOMContentLoaded",function(){a.loadBlocksEditReady(rpageData)})},function(e){404===e.status?a.loadBlocksEditReady([]):a.alerts.alert("Error: "+e.msg+" Status: "+e.status)}):"loading"!==document.readyState?a.loadBlocksEditReady(n):window.addEventListener("DOMContentLoaded",function(){a.loadBlocksEditReady(n)})},this.loadBlocksEdit=n.loadBlocksEdit,a.blockMethod.blockScripts=function(){function e(t,n,a,o,l){if(o&&void 0===window[o]&&l<100)l++,setTimeout(function(){e(t,n,a,o,l)},100);else{var s=n[a];if(""===s.source||t.indexOf(s.source)<0){t.push(s.source);var r=document.createElement("script");r.async=!1,i.options.localMode&&"text/javascript"===r.type?r.src=Bengine.benginePath+"/libs/"+s.source.split("/").slice(-1):r.src=s.source,r.type=s.type,s.integrity&&(r.integrity=s.integrity),r.innerHTML=s.inner,document.getElementsByTagName("head")[0].appendChild(r),n.length>a+1&&e(t,n,a+1,"",0)}}}var t=[];for(var n in a.extensibles)!function(n){if(a.extensibles.hasOwnProperty(n)){var i=a.extensibles[n].fetchDependencies();null!==i&&(e([],i,0,"",0),i.forEach(function(e){e.wait&&t.push(e.wait)}))}}(n);return t},a.blockMethod.blockStyle=function(){for(var e in a.extensibles)!function(e){if(a.extensibles.hasOwnProperty(e)){var t=document.createElement("style");t.type="text/css",t.innerHTML=a.extensibles[e].styleBlock(),document.getElementsByTagName("head")[0].appendChild(t)}}(e)},a.blockMethod.countBlocks=function(){for(var e=0,t=!0;!0===t;)e++,t=Boolean(document.getElementById("bengine-"+a.engineID+"-"+e));return--e},a.blockMethod.generateBlock=function(e,t){var n=document.createElement("div");return i.options.enableSingleView||"title"===t||n.setAttribute("style","margin-bottom:26px;"),n.setAttribute("data-btype",t),n.setAttribute("id","bengine-a-"+a.engineID+"-"+e),n},a.blockMethod.blockButtons=function(e){var t=document.createElement("div");t.setAttribute("class","row"),t.setAttribute("id","bengine-b-"+a.engineID+"-"+e);var n=document.createElement("div");n.setAttribute("id","bengine-cat-"+a.engineID+"-"+e),n.setAttribute("class","bengine-blockbtns row"),t.appendChild(n);let i=1;var o=[];let l;switch(a.categoryCounts.media>0&&(i++,o.push("media")),a.categoryCounts.text>0&&(i++,o.push("text")),a.categoryCounts.quiz>0&&(i++,o.push("quiz")),a.categoryCounts.unknown>0&&(i++,o.push("unknown")),i){case 2:l="50";break;case 3:l="1_3";break;case 4:l="25";break;case 5:l="20";break;default:l="100"}o.forEach(function(i){var o=document.createElement("div");o.setAttribute("class","col col-"+l);var s=document.createElement("button");s.onclick=function(){n.setAttribute("style","display:none;visibility:hidden"),document.getElementById("bengine-"+a.engineID+"-"+i+"-"+e).setAttribute("style","display:block;visibility:visible;")},s.setAttribute("class","bengine-blockbtn bengine-addbtn"),s.innerHTML=i;var r=document.createElement("div");r.setAttribute("id","bengine-"+a.engineID+"-"+i+"-"+e),r.setAttribute("class","bengine-blockbtns row"),r.setAttribute("style","display:none;visibility:hidden;"),t.appendChild(r);var c=document.createElement("div");c.setAttribute("class","col col-100");var d=document.createElement("button");d.onclick=function(){n.setAttribute("style","display:block;visibility:visible"),document.getElementById("bengine-"+a.engineID+"-"+i+"-"+e).setAttribute("style","display:none;visibility:hidden;")},d.setAttribute("class","bengine-blockbtn bengine-addbtn"),d.innerHTML="&larr;";var u=document.createElement("div");u.setAttribute("class","row"),c.appendChild(d),u.appendChild(c),r.appendChild(u),o.appendChild(s),n.appendChild(o)});var s=document.createElement("div");s.setAttribute("class","col col-"+l);var r=document.createElement("button");for(var c in r.setAttribute("id","bengine-d-"+a.engineID+"-"+e),r.setAttribute("class","bengine-blockbtn bengine-delbtn"),r.onclick=function(){a.blockMethod.deleteBlock(e)},r.style.visibility="hidden",r.innerHTML="&darr;",s.appendChild(r),n.appendChild(s),a.extensibles)!function(i){if(a.extensibles.hasOwnProperty(i)){var l=document.createElement("button");l.onclick=function(){a.blockMethod.addBlock(e,a.extensibles[i].type),n.setAttribute("style","display:block;visibility:visible"),document.getElementById("bengine-"+a.engineID+"-"+a.extensibles[i].category+"-"+e).setAttribute("style","display:none;visibility:hidden;")},l.setAttribute("class","bengine-blockbtn bengine-addbtn"),l.innerHTML=a.extensibles[i].name;var s=t.childNodes[o.indexOf(a.extensibles[i].category)+1],r=document.createElement("div");r.setAttribute("class","row");var c=document.createElement("div");c.setAttribute("class","col col-100"),c.appendChild(l),r.appendChild(c),s.appendChild(r)}}(c);return t},a.blockMethod.addRunBtn=function(e,t,n){if(t.upload)return n;if(null===t.runBlock)return n;var i=document.createElement("button");return"code"===t.category?i.innerHTML="Run Code":i.innerHTML="Run Block",i.onclick=function(){t.runBlock(i.parentNode.id)},n.appendChild(i),n},a.blockMethod.makeSpace=function(e,t){for(var n=t;e<n;){var i=n+1,o=a.blockMethod.blockButtons(i);document.getElementById("bengine-b-"+a.engineID+"-"+n).parentNode.replaceChild(o,document.getElementById("bengine-b-"+a.engineID+"-"+n)),document.getElementById("bengine-a-"+a.engineID+"-"+n).setAttribute("id","bengine-a-"+a.engineID+"-"+i),document.getElementById("bengine-"+a.engineID+"-"+n).setAttribute("id","bengine-"+a.engineID+"-"+i),n--}},a.blockMethod.insertBlock=function(e,t,n,i){var o=document.getElementById("bengine-x-blocks-"+a.engineID),l=document.createElement("div");if(l.setAttribute("class","bengine-block bengine-block-"+a.engineID),l.setAttribute("id","bengine-"+a.engineID+"-"+n),l.appendChild(e),l.appendChild(t),n<=i){var s=o.children[n];o.insertBefore(l,s)}else o.appendChild(l)},a.blockMethod.createBlock=function(e,t){var n=a.blockMethod.countBlocks();e<n&&a.blockMethod.makeSpace(e,n);var i=e+1,o=a.blockMethod.generateBlock(i,t.type),l=t.insertContent(o,{});l=a.blockMethod.addRunBtn(i,t,l);var s=a.blockMethod.blockButtons(i);a.blockMethod.insertBlock(l,s,i,n),t.afterDOMinsert("bengine-a-"+a.engineID+"-"+i,null,null);for(var r=0;r<=n;)document.getElementById("bengine-d-"+a.engineID+"-"+r).style.visibility="visible",r++},a.blockMethod.addBlock=function(e,t){if(i.options.blockLimit<document.getElementsByClassName("bengine-block-"+a.engineID).length+1)a.alerts.alert("You Have Reached The Block Limit");else{var n=a.extensibles[t];n.upload?a.datahandler.uploadMedia(e+1,n):(a.blockMethod.createBlock(e,n),a.display.updateSaveStatus("Not Saved"),i.options.enableAutoSave&&saveBlocks(!1))}},a.blockMethod.closeSpace=function(e,t){for(var n=e;n<t;){var i=n+1,o=a.blockMethod.blockButtons(n);document.getElementById("bengine-b-"+a.engineID+"-"+i).parentNode.replaceChild(o,document.getElementById("bengine-b-"+a.engineID+"-"+i)),document.getElementById("bengine-a-"+a.engineID+"-"+i).setAttribute("id","bengine-a-"+a.engineID+"-"+n),document.getElementById("bengine-"+a.engineID+"-"+i).setAttribute("id","bengine-"+a.engineID+"-"+n),n++}},a.blockMethod.removeBlock=function(e){let t=document.getElementById("bengine-"+a.engineID+"-"+e),n=t.childNodes[0],i=n.getAttribute("data-btype");a.extensibles[i].destroy(n),t.parentNode.removeChild(t)},a.blockMethod.deleteBlock=function(e){var t=a.blockMethod.countBlocks(),n=e+1;a.blockMethod.removeBlock(n),n<t&&a.blockMethod.closeSpace(n,t);var o=0;for(t=a.blockMethod.countBlocks();o<t;)document.getElementById("bengine-d-"+a.engineID+"-"+o).style.visibility="visible",o++;document.getElementById("bengine-d-"+a.engineID+"-"+o).style.visibility="hidden",a.display.updateSaveStatus("Not Saved"),i.options.enableAutoSave&&saveBlocks(!1)},"bengine"===i.options.mode?(a.datahandler.createFile=function(){var e=a.blockMethod.countBlocks(),t=1,n=[],i=[];if(e>0)for(var o=1;e>=t;){let e=document.getElementById("bengine-a-"+a.engineID+"-"+t).getAttribute("data-btype");if("quiz"===a.extensibles[e].category){n.push("# "+e+" block cannot be used with Bengine\n\n"),0,t++;continue}let s=a.extensibles[e].saveContent("bengine-a-"+a.engineID+"-"+t).content.replace(/\{\%/g,"\\{%").replace(/\%\}/g,"\\%}");var l="ns"+o++;a.extensibles[e].saveFile&&i.push(a.extensibles[e].saveFile("bengine-a-"+a.engineID+"-"+t)),"qstep"!==e?n.push(`{%${e}:${l}\n${s}\n%}\n\n`):n.push(`@@@@${s}\n\n`),0,t++}var s=n.join("");if(i.length>0){var r=new Bengine.libs.zip;r.file(a.pagePath.replace(/\//g,"")+".txt",s);var c=r.folder("assets");for(asset of i)c.file(asset.name,asset);r.generateAsync({type:"blob"}).then(function(e){Bengine.libs.file.saveAs(e,a.pagePath.replace(/\//g,"")+".zip")})}else{var d=window.open();d.document.open(),d.document.write("<html><head><title>Bengine File</title></head><body>"),d.document.write("<pre>"+s+"</pre>"),d.document.write("</body></html>"),d.document.close()}},a.datahandler.uploadEngineFile=function(){a.datahandler.requestFile(".zip,.txt",function(e){if("application/zip"===e.type)(new Bengine.libs.zip).loadAsync(e).then(function(e){var t,n=[],i=Object.keys(e.files);for(key of i)if("assets/"===key.substr(0,7)&&key.length>7){var o={};o[key.substr(7,key.length-1)]=e.files[key],n.push(o)}else".txt"===key.substr(key.length-4,key.length-1)&&(t=e.files[key]);t&&t.async("string").then(function(e){var t=a.helper.parseEngineFile(e),n=a.helper.convertNjnFormatToPageDataArray(t);a.loadBlocksEditReady(n)})});else if("text/plain"===e.type){var t=new FileReader;t.onload=function(e){var n=a.helper.parseEngineFile(t.result),i=a.helper.convertNjnFormatToPageDataArray(n);a.loadBlocksEditReady(i)},t.readAsText(e)}})}):"qengine"===i.options.mode?(a.datahandler.createFile=function(){var e=a.blockMethod.countBlocks(),t=1,n=[],i=[];if(e>0)for(var o=1;e>=t;){let e=document.getElementById("bengine-a-"+a.engineID+"-"+t).getAttribute("data-btype");if("quiz"!==a.extensibles[e].category){n.push("# "+e+" block cannot be used with Qengine\n\n"),0,t++;continue}let r=a.extensibles[e].saveContent("bengine-a-"+a.engineID+"-"+t),c=r.content.replace(/\{\%/g,"\\{%").replace(/\%\}/g,"\\%}");var l,s;l=Object.keys(r).includes("namespace")&&r.namespace.length>0?r.namespace.trim():"ns"+o++,s=Object.keys(r).includes("conditional")?r.conditional.trim():"",a.extensibles[e].saveFile&&(i=i.concat(a.extensibles[e].saveFile("bengine-a-"+a.engineID+"-"+t))),"qstep"!==e?n.push(`{%${e}:${l}:${s}\n${c}\n%}\n\n`):n.push(`@@@@${c}\n\n`),0,t++}var r=n.join("");if(i.length>0){var c=new Bengine.libs.zip;c.file(a.pagePath.replace(/\//g,"")+".txt",r);var d=c.folder("assets");for(asset of i)try{d.file(asset.name,asset)}catch(e){console.log(e)}c.generateAsync({type:"blob"}).then(function(e){Bengine.libs.file.saveAs(e,a.pagePath.replace(/\//g,"")+".zip")})}else{var u=window.open();u.document.open(),u.document.write("<html><head><title>Qengine File</title></head><body>"),u.document.write("<pre>"+r+"</pre>"),u.document.write("</body></html>"),u.document.close()}},a.datahandler.uploadEngineFile=function(){a.datahandler.requestFile(".zip,.txt",function(e){if("application/zip"===e.type)(new Bengine.libs.zip).loadAsync(e).then(function(e){var t,n=[],i=Object.keys(e.files);for(key of i)if("assets/"===key.substr(0,7)&&key.length>7){var o={};o[key.substr(7,key.length-1)]=e.files[key],n.push(o)}else".txt"===key.substr(key.length-4,key.length-1)&&(t=e.files[key]);t&&t.async("string").then(function(e){var t=a.helper.parseEngineFile(e),n=a.helper.convertNjnFormatToPageDataArray(t);a.loadBlocksEditReady(n)})});else if("text/plain"===e.type){var t=new FileReader;t.onload=function(e){var n=a.helper.parseEngineFile(t.result),i=a.helper.convertNjnFormatToPageDataArray(n);a.loadBlocksEditReady(i)},t.readAsText(e)}})}):(a.datahandler.createFile=function(){},a.datahandler.uploadEngineFile=function(){}),a.datahandler.revertBlocks=function(){var e,t=a.helper.createURL("/revertblocks"),n=document.getElementById("bengine-x-id-"+a.engineID).getAttribute("data-xid"),i=document.getElementById("bengine-x-id-"+a.engineID).getAttribute("name");e=new XMLHttpRequest;var o="xid="+n+"&pagetype="+i;e.open("POST",t,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)switch(e.status){case 500:a.alerts.alert("Unknown Error. Status: 500");break;case 0:a.alerts.alert("Unknown Error. Status: 0");break;case 200:var t=JSON.parse(e.responseText),o=document.getElementById("bengine-instance-"+a.engineID),l=o.parentNode;l.removeChild(o),""===t.data?blockEngineStart(l.getAttribute("id"),[i,n],[]):blockEngineStart(l.getAttribute("id"),[i,n],t.data.split(",")),a.display.updateSaveStatus("Saved");break;default:t=JSON.parse(e.responseText);a.alerts.alert("Error. Status: "+e.status+" Message: "+t.msg)}},e.send(o)},a.datahandler.saveBlocks=function(e){if(a.pagePath.length<1)console.log("Page path is empty, uploads are disabled.");else{var t;t=!1===e?0:1,a.status=t;var n=[],i=[],o=a.blockMethod.countBlocks(),l=1,s={};if(o>0)for(var r=0;o>=l;){var c=document.getElementById("bengine-a-"+a.engineID+"-"+l).getAttribute("data-btype");n[r]=c,i[r]=a.extensibles[c].saveContent("bengine-a-"+a.engineID+"-"+l),r++,l++}s.types=n,s.content=i;var d,u=a.helper.createURL("/save");d=new XMLHttpRequest,!1!==e&&(d.upload.onprogress=function(e){e.lengthComputable&&a.display.progressUpdate(e.loaded)},d.upload.onloadstart=function(e){a.display.progressInitialize("Saving...",e.total)},d.upload.onloadend=function(e){a.display.progressFinalize("Saved",e.total)}),s.eid=a.engineID,s.fpath=a.pagePath,s.tabid=t,d.open("POST",u,!0),d.setRequestHeader("Content-type","application/json"),d.onreadystatechange=function(){if(d.readyState===XMLHttpRequest.DONE)switch(d.status){case 500:a.alerts.alert("Unknown Error. Status: 500");break;case 0:a.alerts.alert("Unknown Error. Status: 0");break;case 200:1===t&&a.display.updateSaveStatus("Saved");break;default:var e=JSON.parse(d.responseText);a.alerts.alert("Error. Status: "+d.status+" Message: "+e.msg)}},d.send(JSON.stringify(s))}},a.datahandler.uploadProcess=function(e,t,n){a.pagePath.length<1?console.log("Page path is empty, uploads are disabled."):new Promise(function(i,o){var l=new FormData;l.append("media",n,n.name);var s=a.helper.createURL("/upload?fpath="+encodeURIComponent(a.pagePath)+"&btype="+t.type),r=new XMLHttpRequest;r.open("POST",s,!0),r.upload.onloadstart=function(e){a.display.progressInitialize("Uploading...",e.total)},r.upload.onprogress=function(e){e.lengthComputable&&a.display.progressUpdate(e.loaded)},r.upload.onloadend=function(e){a.display.progressFinalize("Uploaded",e.total)},r.onprogress=function(e){var t=a.helper.position(r.responseText.length),n=a.helper.counter(!1),i=r.responseText.slice(t[0],t[1]).split(",");1===n?a.display.progressInitialize("Converting...",i[i.length-1]):a.display.progressUpdate(i[i.length-1])},r.onloadend=function(e){var t=a.helper.position(r.responseText.length),n=r.responseText.slice(t[0],t[1]).split(",");a.display.progressFinalize("Not Saved",n[n.length-1]),a.helper.counter(!0),a.helper.position(0)},r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE)switch(r.status){case 200:if("Error:"!==r.responseText.substr(0,6)){var t=a.helper.position(r.responseText.length),n=r.responseText.slice(t[0],t[1]).split(",");i({msg:"Success",status:200,data:{spot:n[n.length-1]}})}else a.blockMethod.deleteBlock(e-1),o({msg:r.responseText,status:500,data:{}});break;default:a.blockMethod.deleteBlock(e-1);var l=JSON.parse(r.responseText);o({msg:l.msg,status:r.status,data:{}})}},r.send(l)}).then(function(n){t.afterDOMinsert("bengine-a-"+a.engineID+"-"+e,n.data.spot,null),a.display.updateSaveStatus("Not Saved"),i.options.enableAutoSave&&saveBlocks(!1)},function(e){a.alerts.log(e.msg)})},a.datahandler.requestFile=function(e,t){var n=document.getElementById("bengine-file-select-"+a.engineID);"undefined"!==e&&"string"==typeof e?n.setAttribute("accept",e):n.setAttribute("accept",""),n.click(),n.onchange=function(){var e=n.files[0];n.files.length>0?e.size>1048576*i.options.mediaLimit?a.alerts.alert(`Files Must Be Less Than ${i.options.mediaLimit} MB`):("function"==typeof t&&t(e),this.value=null):this.value=null}},a.datahandler.uploadMedia=function(e,t){var n=document.getElementById("bengine-file-select-"+a.engineID);"undefined"!==t.accept&&"string"==typeof t.accept?n.setAttribute("accept",t.accept):n.setAttribute("accept",""),n.click(),n.onchange=function(){var o=n.files[0];if(n.files.length>0)if(o.size>1048576*i.options.mediaLimit)a.alerts.alert(`Files Must Be Less Than ${i.options.mediaLimit} MB`);else{var l=!1,s=!1;switch(t.type){case"audio":var r=document.createElement("audio"),c=URL.createObjectURL(o);r.src=c,s=!0;break;case"video":var d=document.createElement("video"),u=URL.createObjectURL(o);d.src=u,l=!0}l?d.ondurationchange=function(){this.duration>i.options.playableMediaLimit?a.alerts.alert(`Video Files Must Be Less Than ${i.options.playableMediaLimit} Seconds`):p(e,t,o)}:s?r.ondurationchange=function(){this.duration>i.options.playableMediaLimit?a.alerts.alert(`Audio Files Must Be Less Than ${i.options.playableMediaLimit} Seconds`):p(e,t,o)}:p(e,t,o),this.value=null}else this.value=null;function p(e,t,n){a.blockMethod.createBlock(e-1,t),t.afterDOMinsert("bengine-a-"+a.engineID+"-"+e,null,n),a.datahandler.uploadProcess(e,t,n),a.display.updateSaveStatus("Not Saved")}}}}function Qengine(e,t){if("object"!=typeof e)var n={};else n=e;return n.mode="qengine",new Bengine(n,t)}Bengine.libs={zip:null,file:null,"#":["https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js","https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"]},Bengine.setScriptPath=function(e){if(e)return Bengine.minifiedMode=n.pop().indexOf("min")>-1,void(Bengine.benginePath=n.slice(0,-1).join("/"));var t=document.getElementsByTagName("script");for(key in t)if(t[key].src&&t[key].src.indexOf("bengine")>-1){var n=t[key].src.split("/");if(n.length<2)throw"Invalid Bengine script path. Bengine should be in js/bengine[.min].js";Bengine.minifiedMode=n.pop().indexOf("min")>-1,Bengine.benginePath=n.slice(0,-1).join("/");break}if(!Bengine.benginePath)throw"Unable to find Bengine path"},Bengine.loadBlocks=function(e){if(void 0===e)return-1;void 0===Bengine.benginePath&&Bengine.setScriptPath();var t=e,n=[];function i(e){var i,a;"SCRIPT"===e.target.tagName&&(void 0!==(i=e.target.src.split("/").pop().split(".")[0])&&(console.log("failed to load: "+i),n.push(i),-1!==(a=t.indexOf(i))&&t.splice(a,1)));"LINK"===e.target.tagName&&(void 0!==(i=e.target.href.split("/").pop().split(".")[0])&&(console.log("failed to link: "+i),n.push(i),-1!==(a=t.indexOf(i))&&t.splice(a,1)))}function a(e){return new Promise(t=>setTimeout(t,e))}return window.addEventListener("error",i,!0),(e=e.concat(Bengine.libs["#"])).forEach(function(e){if(e.indexOf(".css")>-1){var n=document.createElement("link");n.onload=function(n){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},n.rel="stylesheet",n.defer=!0,n.href=e,document.getElementsByTagName("head")[0].appendChild(n)}else{var i=document.createElement("script");if(i.onload=function(n){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},i.async=!1,e.indexOf("http")>-1&&e.indexOf("//")>-1)if(e.indexOf("RELATIVE")>-1){var a=e.split("/").slice(3).join("/");i.src=a}else i.src=e;else Bengine.minifiedMode?i.src=Bengine.benginePath+"/blocks/"+e+".min.js":i.src=Bengine.benginePath+"/blocks/"+e+".js";i.type="text/javascript",i.onload=function(e){var t=e.path[0].src.split("/");switch(t[t.length-1].split(".")[0]){case"jszip":Bengine.libs.zip=JSZip;break;case"FileSaver":Bengine.libs.file={saveAs:window.saveAs}}},document.getElementsByTagName("head")[0].appendChild(i)}}),new Promise(async function(e,o){for(var l=0;t.length>0&&l<100;)await a(50),l++;window.removeEventListener("error",i),e(n)})},Bengine.extensibles={};