"use strict";function AlgoVisualizer(e){var t=new AVTopMenu(e),r=new AVTracerManager(e,t),s=new AVEditor(r,t);AVDom(e,r,s,t),this.state={id:e,isLoading:!1,editor:s,tracerManager:r,categories:{},loadedScratch:null,wikiList:[]},this.getIsLoading=(()=>state.isLoading),this.setIsLoading=(e=>{state.isLoading=e}),this.getEditor=(()=>state.editor),this.getCategories=(()=>state.categories),this.getCategory=(e=>state.categories[e]),this.setCategories=(e=>{state.categories=e}),this.updateCategory=((e,t)=>{$.extend(state.categories[e],t)}),this.getTracerManager=(()=>state.tracerManager),this.getLoadedScratch=(()=>state.loadedScratch),this.setLoadedScratch=(e=>{state.loadedScratch=e}),this.getWikiList=(()=>state.wikiList),this.setWikiList=(e=>{state.wikiList=e}),this.hasWiki=(e=>~state.wikiList.indexOf(e))}function AVDom(e,t,r,s){var a="#"+e;$(".av-btn input").click(e=>{e.stopPropagation()}),$(document).mouseup(function(e){t.command("mouseup",e)});const i=$(a+"-interval");i.val(.5),i.attr({max:10,min:.1,step:.1});$(a+"-interval").on("change",function(){const[e,r]=(e=>{let t,r;return e<.1?(t=.1,r=`Interval of ${e} seconds is too low. Setting to min allowed interval of 0.1 second(s).`):e>10?(t=10,r=`Interval of ${e} seconds is too high. Setting to max allowed interval of 10 second(s).`):(t=e,r=`Interval has been set to ${e} second(s).`),[t,r]})(Number.parseFloat($(this).val()));$(this).val(e),t.interval=1e3*e,console.log(r)});const o=$(a+"-tab_module");o.on("mousedown",".module_wrapper",function(e){t.findOwner(this).mousedown(e)}),o.on("mousemove",".module_wrapper",function(e){t.findOwner(this).mousemove(e)}),o.on("DOMMouseScroll mousewheel",".module_wrapper",function(e){t.findOwner(this).mousewheel(e)});const n=$(a+"-btn_run"),l=$(a+"-btn_pause"),h=$(a+"-btn_prev"),c=$(a+"-btn_next");s.disableFlowControl(),n.click(()=>{l.removeClass("av-active"),n.addClass("av-active"),s.enableFlowControl();var e=r.execute();e&&(console.error(e),s.resetTopMenuButtons())}),l.click(()=>{n.toggleClass("av-active"),l.toggleClass("av-active"),t.isPause()?t.resumeStep():t.pauseStep()}),h.click(()=>{n.removeClass("av-active"),l.addClass("av-active"),t.pauseStep(),t.prevStep()}),c.click(()=>{n.removeClass("av-active"),l.addClass("av-active"),t.pauseStep(),t.nextStep()}),$(window).resize(function(){t.resize()})}function AVEditor(tracerManager,topMenu){if(!tracerManager||!topMenu)throw"Cannot create Editor. Missing the tracerManager or topMenu";this.tracerManager=tracerManager,this.topMenu=topMenu,ace.require("ace/ext/language_tools");const Range=ace.require("ace/range").Range;this.createEditor=(e=>{const t=ace.edit(e);return t.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),t.setTheme("ace/theme/tomorrow_night_eighties"),t.session.setMode("ace/mode/javascript"),t.$blockScrolling=1/0,t}),this.codeEditor=this.createEditor("code"),this.setCode=(e=>{this.codeEditor.setValue(e,-1)}),this.setContent=(({code:e})=>{this.setCode(e)}),this.clearCode=(()=>{this.codeEditor.setValue("")}),this.clearContent=(()=>{this.clearCode()}),this.execute=(()=>{const e=this.codeEditor.getValue();return this.executeDataAndCode(this.tracerManager,"",e)}),this.highlightLine=(e=>{const t=this.codeEditor.getSession();this.marker&&t.removeMarker(this.marker),this.marker=t.addMarker(new Range(e,0,e,1/0),"executing","line",!0)}),this.unhighlightLine=(()=>{const e=this.codeEditor.getSession();this.marker&&e.removeMarker(this.marker)}),this.resize=(()=>{this.codeEditor.resize()}),this.executeWithArgs=((tracerManager,code,dataLines)=>{try{tracerManager.deallocateAll();const lines=code.split("\n"),newLines=[];lines.forEach((e,t)=>{newLines.push(e.replace(/(.+\. *_wait *)(\( *\))/g,`$1(${t-dataLines})`))}),eval(newLines.join("\n")),tracerManager.visualize()}catch(e){return e}finally{tracerManager.removeUnallocated()}}),this.executeDataAndCode=((e,t,r)=>{const s=t.split("\n").length;return this.executeWithArgs(e,`${t}\n${r}`,s)}),this.codeEditor.on("change",()=>{this.codeEditor.getValue();this.tracerManager.reset(),this.topMenu.resetTopMenuButtons(),this.unhighlightLine()})}function AVTopMenu(e){this.id="#"+e;const t=[$(this.id+"-btn_pause"),$(this.id+"-btn_prev"),$(this.id+"-btn_next")],r=e=>{t.forEach(t=>t.attr("disabled",e))};this.enableFlowControl=(()=>{r(!1)}),this.disableFlowControl=(()=>{r(!0)}),this.resetTopMenuButtons=(()=>{$(this.id+"-top-menu-buttons button").removeClass("av-active"),this.disableFlowControl()}),this.setInterval=(e=>{$(this.id+"-interval").val(interval)}),this.activateBtnPause=(()=>{$(this.id+"-btn_pause").addClass("av-active")}),this.deactivateBtnPause=(()=>{$(this.id+"-btn_pause").removeClass("av-active")})}function AVTracerManager(e,t){this.id="#"+e,this.timer=null,this.pause=!1,this.capsules=[],this.interval=500,this.topMenu=t,this.add=function(e){const t=$('<section class="module_wrapper">');$(this.id+"-tab_module").append(t);const r={module:e.module,tracer:e,allocated:!0,defaultName:null,$container:t,isNew:!0};return this.capsules.push(r),r},this.allocate=function(e){let t=null,r=0;$.each(this.capsules,(s,a)=>{if(a.module===e.module&&(r++,!a.allocated))return a.tracer=e,a.allocated=!0,a.isNew=!1,t=a,!1}),null===t&&(r++,t=this.add(e));const s=e.module.getClassName();return t.defaultName=`${s} ${r}`,t.order=this.order++,t},this.deallocateAll=function(){this.order=0,this.reset(),$.each(this.capsules,(e,t)=>{t.allocated=!1})},this.removeUnallocated=function(){let e=!1;this.capsules=$.grep(this.capsules,t=>{let r=!t.allocated;return(t.isNew||r)&&(e=!0),r&&t.$container.remove(),!r}),e&&this.place()},this.place=function(){const{capsules:e}=this;$.each(e,(t,r)=>{let s=100/e.length,a=s*r.order;r.$container.css({top:`${a}%`,width:"100%",height:`${s}%`}),r.tracer.resize()})},this.resize=function(){this.command("resize")},this.isPause=function(){return this.pause},this.setInterval=function(e){this.topMenu.setInterval(e)},this.reset=function(){this.traces=[],this.traceIndex=-1,this.stepCnt=0,this.timer&&clearTimeout(this.timer),this.command("clear")},this.pushStep=function(e,t){if(this.stepCnt++>1e6)throw"Tracer's stack overflow";let r=this.traces.length;0==r&&(r+=this.newStep());this.traces[r-1].push($.extend(t,{capsule:e}))},this.newStep=function(e=-1){let t=this.traces.length;return t>0&&~e&&this.traces[t-1].push(e),this.traces.push([])},this.pauseStep=function(){this.traceIndex<0||(this.pause=!0,this.timer&&clearTimeout(this.timer),this.topMenu.activateBtnPause())},this.resumeStep=function(){this.pause=!1,this.step(this.traceIndex+1),this.topMenu.deactivateBtnPause()},this.step=function(e,t={}){const r=this;if(isNaN(e)||e>=this.traces.length||e<0)return;this.traceIndex=e;this.traces[e].forEach(e=>{"number"!=typeof e&&e.capsule.tracer.processStep(e,t)}),t.virtual||this.command("refresh"),this.pause||(this.timer=setTimeout(()=>{r.nextStep(t)||this.topMenu.resetTopMenuButtons()},this.interval))},this.prevStep=function(e={}){this.command("clear");const t=this.traceIndex-1;if(t<0)return this.traceIndex=-1,this.command("refresh"),!1;for(let r=0;r<t;r++)this.step(r,$.extend(e,{virtual:!0}));return this.step(t),!0},this.nextStep=function(e={}){const t=this.traceIndex+1;return t>=this.traces.length?(this.traceIndex=this.traces.length-1,!1):(this.step(t,e),!0)},this.visualize=function(){this.traceIndex=-1,this.resumeStep()},this.command=function(...e){const t=e.shift();$.each(this.capsules,(r,s)=>{s.allocated&&s.tracer.module.prototype[t].apply(s.tracer,e)})},this.findOwner=function(e){let t=null;return $.each(this.capsules,(r,s)=>{if(s.$container[0]===e)return t=s,!1}),t.tracer}}var Alvi={};Alvi.Integer={random:(e,t)=>(Math.random()*(t-e+1)|0)+e},Alvi.Array2D={random:(e,t,r,s)=>{e||(e=10),t||(t=10),void 0===r&&(r=1),void 0===s&&(s=9);for(var a=[],i=0;i<e;i++){a.push([]);for(var o=0;o<t;o++)a[i].push(Alvi.Integer.random(r,s))}return a},randomSorted:(e,t,r,s)=>random(e,t,r,s).map(function(e){return e.sort(function(e,t){return e-t})})},Alvi.Array1D={random:(e,t,r)=>Alvi.Array2D.random(1,e,t,r)[0],randomSorted:(e,t,r)=>Alvi.Array2D.randomSorted(1,e,t,r)[0]},Alvi.CoordinateSystems={random:(e,t,r)=>{e||(e=7),t||(t=1),r||(r=10);for(var s=new Array(e),a=0;a<e;a++)s[a]=new Array(2);for(a=0;a<e;a++)for(var i=0;i<s[a].length;i++)s[a][i]=Alvi.Integer.random(t,r);return s}},Alvi.DirectedGraph={random:(e,t)=>{e||(e=5),t||(t=.3);for(var r=new Array(e),s=0;s<e;s++){r[s]=new Array(e);for(var a=0;a<e;a++)s!=a&&(r[s][a]=0==(Math.random()*(1/t)|0)?1:0)}return r}},Alvi.UndirectedGraph={random:(e,t)=>{e||(e=5),t||(t=.3);for(var r=new Array(e),s=0;s<e;s++)r[s]=new Array(e);for(s=0;s<e;s++)for(var a=0;a<e;a++)s>a&&(r[s][a]=r[a][s]=0==(Math.random()*(1/t)|0)?1:0);return r}},Alvi.WeightedDirectedGraph={random:(e,t,r,s)=>{e||(e=5),t||(t=.3),r||(r=1),s||(s=5);for(var a=new Array(e),i=0;i<e;i++){a[i]=new Array(e);for(var o=0;o<e;o++)i!=o&&0==(Math.random()*(1/t)|0)&&(a[i][o]=Alvi.Integer.random(r,s))}return a}},Alvi.WeightedDirectedGraph={random:(e,t,r,s)=>{e||(e=5),t||(t=.3),r||(r=1),s||(s=5);for(var a=new Array(e),i=0;i<e;i++)a[i]=new Array(e);for(i=0;i<e;i++)for(var o=0;o<e;o++)i>o&&0==(Math.random()*(1/t)|0)&&(a[i][o]=a[o][i]=Alvi.Integer.random(r,s));return a}},Alvi.Tracer=class{static getClassName(){return"Tracer"}constructor(e,t){this.module=this.constructor,this.color={selected:"#2962ff",notified:"#f50057",visited:"#f50057",left:"#616161",default:"#bdbdbd"},this.manager=t,this.capsule=this.manager.allocate(this),$.extend(this,this.capsule),this.setName(e)}_setData(...e){return this.manager.pushStep(this.capsule,{type:"setData",args:AVTracerManagerUtil.toJSON(e)}),this}_clear(){return this.manager.pushStep(this.capsule,{type:"clear"}),this}_wait(e){return this.manager.newStep(e),this}processStep(e,t){const{type:r,args:s}=e;switch(r){case"setData":this.setData(...AVTracerManagerUtil.fromJSON(s));break;case"clear":this.clear()}}setName(e){}setData(){const e=AVTracerManagerUtil.toJSON(arguments);return!this.isNew&&this.lastData===e||(this.lastData=this.capsule.lastData=e,!1)}resize(){}refresh(){}clear(){}attach(e){switch(e.module){case Alvi.LogTracer:this.logTracer=e;break;case Alvi.ChartTracer:this.chartTracer=e}return this}palette(e){return $.extend(this.color,e),this}mousedown(e){}mousemove(e){}mouseup(e){}mousewheel(e){}},Alvi.Array2DTracer=class extends Alvi.Tracer{static getClassName(){return"Array2DTracer"}constructor(e,t){if(super(e,t),this.isNew){var r=this;r.$table=r.capsule.$table=$('<div class="av-mtbl-table">'),r.$container.append(r.$table)}}_notify(e,t,r){return this.manager.pushStep(this.capsule,{type:"notify",x:e,y:t,v:r}),this}_denotify(e,t){return this.manager.pushStep(this.capsule,{type:"denotify",x:e,y:t}),this}_select(e,t,r,s){return this.pushSelectingStep("select",null,arguments),this}_selectRow(e,t,r){return this.pushSelectingStep("select","row",arguments),this}_selectCol(e,t,r){return this.pushSelectingStep("select","col",arguments),this}_deselect(e,t,r,s){return this.pushSelectingStep("deselect",null,arguments),this}_deselectRow(e,t,r){return this.pushSelectingStep("deselect","row",arguments),this}_deselectCol(e,t,r){return this.pushSelectingStep("deselect","col",arguments),this}_separate(e,t){return this.manager.pushStep(this.capsule,{type:"separate",x:e,y:t}),this}_separateRow(e){return this._separate(e,-1),this}_separateCol(e){return this._separate(-1,e),this}_deseparate(e,t){return this.manager.pushStep(this.capsule,{type:"deseparate",x:e,y:t}),this}_deseparateRow(e){return this._deseparate(e,-1),this}_deseparateCol(e){return this._deseparate(-1,e),this}pushSelectingStep(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e.shift();e=Array.prototype.slice.call(e.shift());var s;switch(r){case"row":s={x:e[0],sy:e[1],ey:e[2]};break;case"col":s={y:e[0],sx:e[1],ex:e[2]};break;default:s=void 0===e[2]&&void 0===e[3]?{x:e[0],y:e[1]}:{sx:e[0],sy:e[1],ex:e[2],ey:e[3]}}var a={type:t};$.extend(a,s),this.manager.pushStep(this.capsule,a)}processStep(e,t){switch(e.type){case"notify":if(void 0!==e.v){this.$table.find(".av-mtbl-row").eq(e.x).find(".av-mtbl-col").eq(e.y).text(AVTracerManagerUtil.refineByType(e.v))}case"denotify":case"select":case"deselect":var r="select"==e.type||"deselect"==e.type?this.color.selected:this.color.notified,s="select"==e.type||"notify"==e.type,a=e.sx,i=e.sy,o=e.ex,n=e.ey;void 0===a&&(a=e.x),void 0===i&&(i=e.y),void 0===o&&(o=e.x),void 0===n&&(n=e.y),this.paintColor(a,i,o,n,r,s);break;case"separate":this.deseparate(e.x,e.y),this.separate(e.x,e.y);break;case"deseparate":this.deseparate(e.x,e.y);break;default:super.processStep(e,t)}}setData(e){if(this.viewX=this.viewY=0,this.paddingH=6,this.paddingV=3,this.fontSize=16,super.setData.apply(this,arguments))return this.$table.find(".av-mtbl-row").each(function(t){$(this).find(".av-mtbl-col").each(function(r){$(this).text(AVTracerManagerUtil.refineByType(e[t][r]))})}),!0;this.$table.empty();for(var t=0;t<e.length;t++){var r=$('<div class="av-mtbl-row">');this.$table.append(r);for(var s=0;s<e[t].length;s++){var a=$('<div class="av-mtbl-col">').css(this.getCellCss()).text(AVTracerManagerUtil.refineByType(e[t][s]));r.append(a)}}return this.resize(),!1}resize(){super.resize(),this.refresh()}clear(){super.clear(),this.clearColor(),this.deseparateAll()}getCellCss(){return{padding:this.paddingV.toFixed(1)+"px "+this.paddingH.toFixed(1)+"px","font-size":this.fontSize.toFixed(1)+"px"}}refresh(){super.refresh();var e=this.$table.parent(),t=e.height()/2-this.$table.height()/2+this.viewY,r=e.width()/2-this.$table.width()/2+this.viewX;this.$table.css("margin-top",t),this.$table.css("margin-left",r)}mousedown(e){super.mousedown(e),this.dragX=e.pageX,this.dragY=e.pageY,this.dragging=!0}mousemove(e){super.mousemove(e),this.dragging&&(this.viewX+=e.pageX-this.dragX,this.viewY+=e.pageY-this.dragY,this.dragX=e.pageX,this.dragY=e.pageY,this.refresh())}mouseup(e){super.mouseup(e),this.dragging=!1}mousewheel(e){super.mousewheel(e),e.preventDefault();var t=(void 0!==(e=e.originalEvent).wheelDelta&&e.wheelDelta||void 0!==e.detail&&-e.detail)>0?1/1.01:1.01;this.fontSize<4&&t<1||this.fontSize>40&&t>1||(this.paddingV*=t,this.paddingH*=t,this.fontSize*=t,this.$table.find(".mtbl-col").css(this.getCellCss()),this.refresh())}paintColor(e,t,r,s,a,i){for(var o=e;o<=r;o++)for(var n=this.$table.find(".av-mtbl-row").eq(o),l=t;l<=s;l++){var h=n.find(".av-mtbl-col").eq(l);i?h.css("background",a):h.css("background","")}}clearColor(){this.$table.find(".av-mtbl-col").css("background","")}separate(e,t){this.$table.find(".av-mtbl-row").each(function(r){var s=$(this);r==e&&s.after($('<div class="av-mtbl-empty-row">').attr("data-row",r)),s.find(".av-mtbl-col").each(function(e){var r=$(this);e==t&&r.after($('<div class="av-mtbl-empty-col">').attr("data-col",e))})})}deseparate(e,t){this.$table.find("[data-row="+e+"]").remove(),this.$table.find("[data-col="+t+"]").remove()}deseparateAll(){this.$table.find(".av-mtbl-empty-row, .av-mtbl-empty-col").remove()}},Alvi.Array1DTracer=class extends Alvi.Array2DTracer{static getClassName(){return"Array1DTracer"}constructor(e,t){super(e,t)}_notify(e,t){return super._notify(0,e,t),this}_denotify(e){return super._denotify(0,e),this}_select(e,t){return void 0===t?super._select(0,e):super._selectRow(0,e,t),this}_deselect(e,t){return void 0===t?super._deselect(0,e):super._deselectRow(0,e,t),this}processStep(e,t){if(super.processStep(e,t),this.chartTracer){const r=$.extend(!0,{},e);r.capsule=this.chartTracer.capsule,r.s=r.sy,r.e=r.ey,void 0===r.s&&(r.s=r.y),delete r.x,delete r.y,delete r.sx,delete r.sy,delete r.ex,delete r.ey,this.chartTracer.processStep(r,t)}}setData(e){return super.setData([e])}},Alvi.ChartTracer=class extends Alvi.Tracer{static getClassName(){return"ChartTracer"}constructor(e,t){if(super(e,t),this.isNew){var r=this;r.$wrapper=r.capsule.$wrapper=$('<canvas class="av-mchrt-chart">'),r.$container.append(r.$wrapper),r.chart=r.capsule.chart=new Chart(r.$wrapper,{type:"bar",data:{labels:[],datasets:[]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},animation:!1,legend:!1,responsive:!0,maintainAspectRatio:!1}})}}setData(e){if(super.setData.apply(this,arguments))return this.chart.config.data.datasets[0].data=e,this.chart.update(),!0;for(var t=[],r=0;r<e.length;r++)t.push(this.color.default);this.chart.config.data={labels:e.map(String),datasets:[{backgroundColor:t,data:e}]},this.chart.update()}_notify(e,t){return this.manager.pushStep(this.capsule,{type:"notify",s:e,v:t}),this}_denotify(e){return this.manager.pushStep(this.capsule,{type:"denotify",s:e}),this}_select(e,t){return this.manager.pushStep(this.capsule,{type:"select",s:e,e:t}),this}_deselect(e,t){return this.manager.pushStep(this.capsule,{type:"deselect",s:e,e:t}),this}processStep(e,t){switch(e.type){case"notify":void 0!==e.v&&(this.chart.config.data.datasets[0].data[e.s]=e.v,this.chart.config.data.labels[e.s]=e.v.toString());case"denotify":case"select":case"deselect":let s="notify"==e.type?this.color.notified:"select"==e.type?this.color.selected:this.color.default;if(void 0!==e.e)for(var r=e.s;r<=e.e;r++)this.chart.config.data.datasets[0].backgroundColor[r]=s;else this.chart.config.data.datasets[0].backgroundColor[e.s]=s;this.chart.update();break;default:super.processStep(e,t)}}resize(){super.resize(),this.chart.resize()}clear(){super.clear();const e=this.chart.config.data;if(e.datasets.length){const t=e.datasets[0].backgroundColor;for(let e=0;e<t.length;e++)t[e]=this.color.default;this.chart.update()}}},Alvi.DirectedGraphTracer=class extends Alvi.Tracer{static getClassName(){return"DirectedGraphTracer"}constructor(e,t){if(super(e,t),this.isNew){var r=this;r.s=r.capsule.s=new sigma({renderer:{container:r.$container[0],type:"canvas"},settings:{minArrowSize:8,defaultEdgeType:"arrow",maxEdgeSize:2.5,labelThreshold:4,font:"Roboto",defaultLabelColor:"#fff",zoomMin:.6,zoomMax:1.2,skipErrors:!0,minNodeSize:.5,maxNodeSize:12,labelSize:"proportional",labelSizeRatio:1.3,funcLabelsDef(e,t,s){r.drawLabel(e,t,s)},funcHoversDef(e,t,s,a){r.drawOnHover(e,t,s,a)},funcEdgesArrow(e,t,s,a,i){var o=r.getColor(e,t,s,i);r.drawArrow(e,t,s,o,a,i)}}}),sigma.plugins.dragNodes(r.s,r.s.renderers[0]),r.graph=r.capsule.graph=r.s.graph}}_setTreeData(e,t){return this.manager.pushStep(this.capsule,{type:"setTreeData",arguments:arguments}),this}_visit(e,t){return this.manager.pushStep(this.capsule,{type:"visit",target:e,source:t}),this}_leave(e,t){return this.manager.pushStep(this.capsule,{type:"leave",target:e,source:t}),this}_setNodePositions(e){return this.manager.pushStep(this.capsule,{type:"setNodePositions",positions:e}),this}processStep(e,t){switch(e.type){case"setTreeData":this.setTreeData.apply(this,e.arguments);break;case"setNodePositions":$.each(this.graph.nodes(),(t,r)=>{if(t>=e.positions.length)return!1;const s=e.positions[t];r.x=s.x,r.y=s.y});break;case"visit":case"leave":var r="visit"==e.type,s=this.graph.nodes(this.n(e.target)),a=r?this.color.visited:this.color.left;if(s.color=a,void 0!==e.source){var i=this.e(e.source,e.target),o=this.graph.edges(i);o.color=a,this.graph.dropEdge(i).addEdge(o)}if(this.logTracer){var n=e.source;void 0===n&&(n=""),this.logTracer.print(r?n+" -> "+e.target:n+" <- "+e.target)}break;default:super.processStep(e,t)}}setTreeData(e,t,r){var s=this;t=t||0;var a=-1,i=new Array(e.length),o=function(t,r){if(i[t])throw"the given graph is not a tree because it forms a circuit";i[t]=!0,a<r&&(a=r);for(var s=0;s<e[t].length;s++)e[t][s]&&o(s,r+1)};if(o(t,1),this.setData(e,r))return!0;var n=1/(a-1),l=function(t,r,a,i){!function(e,t,r){var a=s.graph.nodes(s.n(e));a.x=t,a.y=r}(t,a+i,r*n);for(var o=0,h=0;h<e[t].length;h++)e[t][h]&&o++;for(var c=(i-a)/o,d=0,h=0;h<e[t].length;h++)e[t][h]&&l(h,r+1,a+c*d,a+c*++d)};l(t,0,0,1),this.refresh()}setData(e,t){if(super.setData.apply(this,arguments))return!0;this.graph.clear();const r=[],s=[],a=2*Math.PI/e.length;let i=0;for(let o=0;o<e.length;o++)if(i+=a,r.push({id:this.n(o),label:""+o,x:.5+Math.sin(i)/2,y:.5+Math.cos(i)/2,size:1,color:this.color.default,weight:0}),t)for(let t=0;t<=o;t++){const r=e[o][t]||e[t][o];r&&s.push({id:this.e(o,t),source:this.n(o),target:this.n(t),color:this.color.default,size:1,weight:AVTracerManagerUtil.refineByType(r)})}else for(let t=0;t<e[o].length;t++)e[o][t]&&s.push({id:this.e(o,t),source:this.n(o),target:this.n(t),color:this.color.default,size:1,weight:AVTracerManagerUtil.refineByType(e[o][t])});return this.graph.read({nodes:r,edges:s}),this.s.camera.goTo({x:0,y:0,angle:0,ratio:1}),this.refresh(),!1}resize(){super.resize(),this.s.renderers[0].resize(),this.refresh()}refresh(){super.refresh(),this.s.refresh()}clear(){super.clear(),this.clearGraphColor(),this.refresh()}clearGraphColor(){var e=this;this.graph.nodes().forEach(function(t){t.color=e.color.default}),this.graph.edges().forEach(function(t){t.color=e.color.default})}n(e){return"n"+e}e(e,t){return"e"+e+"_"+t}getColor(e,t,r,s){var a=e.color,i=s("edgeColor"),o=s("defaultNodeColor"),n=s("defaultEdgeColor");if(!a)switch(i){case"source":a=t.color||o;break;case"target":a=r.color||o;break;default:a=n}return a}drawLabel(e,t,r){var s,a=r("prefix")||"",i=e[a+"size"];i<r("labelThreshold")||e.label&&"string"==typeof e.label&&(s="fixed"===r("labelSize")?r("defaultLabelSize"):r("labelSizeRatio")*i,t.font=(r("fontStyle")?r("fontStyle")+" ":"")+s+"px "+r("font"),t.fillStyle="node"===r("labelColor")?e.color||r("defaultNodeColor"):r("defaultLabelColor"),t.textAlign="center",t.fillText(e.label,Math.round(e[a+"x"]),Math.round(e[a+"y"]+s/3)))}drawArrow(e,t,r,s,a,i){var o=i("prefix")||"",n=e[o+"size"]||1,l=r[o+"size"],h=t[o+"x"],c=t[o+"y"],d=r[o+"x"],p=r[o+"y"],u=Math.atan2(p-c,d-h);h+=3*Math.sin(u),d+=3*Math.sin(u),c+=3*-Math.cos(u),p+=3*-Math.cos(u);var g=Math.max(2.5*n,i("minArrowSize")),f=Math.sqrt(Math.pow(d-h,2)+Math.pow(p-c,2)),v=h+(d-h)*(f-g-l)/f,m=c+(p-c)*(f-g-l)/f,w=(d-h)*g/f,y=(p-c)*g/f;a.strokeStyle=s,a.lineWidth=n,a.beginPath(),a.moveTo(h,c),a.lineTo(v,m),a.stroke(),a.fillStyle=s,a.beginPath(),a.moveTo(v+w,m+y),a.lineTo(v+.6*y,m-.6*w),a.lineTo(v-.6*y,m+.6*w),a.lineTo(v+w,m+y),a.closePath(),a.fill()}drawOnHover(e,t,r,s){var a=this;t.setLineDash([5,5]);var i=e.id.substring(1);this.graph.edges().forEach(function(o){var n=o.id.substring(1).split("_");if(n[0]==i){var l="#0ff",h=e,c=a.graph.nodes("n"+n[1]);a.drawArrow(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}else if(n[1]==i){var l="#ff0",h=a.graph.nodes("n"+n[0]),c=e;a.drawArrow(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}})}},Alvi.CoordinateSystemTracer=class extends Alvi.DirectedGraphTracer{static getClassName(){return"CoordinateSystemTracer"}constructor(e,t){super(e,t),this.isNew&&this.s.settings({defaultEdgeType:"def",funcEdgesDef(e,t,r,s,a){var i=this.getColor(e,t,r,a);this.drawEdge(e,t,r,i,s,a)}})}setData(e){if(Tracer.prototype.setData.apply(this,arguments))return!0;this.graph.clear();for(var t=[],r=0;r<e.length;r++)t.push({id:this.n(r),x:e[r][0],y:e[r][1],label:""+r,size:1});return this.graph.read({nodes:t,edges:[]}),this.s.camera.goTo({x:0,y:0,angle:0,ratio:1}),this.refresh(),!1}processStep(e,t){switch(e.type){case"visit":case"leave":var r="visit"==e.type,s=this.graph.nodes(this.n(e.target)),a=r?this.color.visited:this.color.left;if(s.color=a,void 0!==e.source){var i=this.e(e.source,e.target);if(this.graph.edges(i)){var o=this.graph.edges(i);o.color=a,this.graph.dropEdge(i).addEdge(o)}else this.graph.addEdge({id:this.e(e.target,e.source),source:this.n(e.source),target:this.n(e.target),size:1})}if(this.logTracer){var n=e.source;void 0===n&&(n=""),this.logTracer.print(r?n+" -> "+e.target:n+" <- "+e.target)}break;default:super.processStep(e,t)}}e(e,t){if(e>t){var r=e;e=t,t=r}return"e"+e+"_"+t}drawOnHover(e,t,r,s){var a=this;t.setLineDash([5,5]);var i=e.id.substring(1);this.graph.edges().forEach(function(o){var n=o.id.substring(1).split("_");if(n[0]==i){var l="#0ff",h=e,c=a.graph.nodes("n"+n[1]);a.drawEdge(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}else if(n[1]==i){var l="#0ff",h=a.graph.nodes("n"+n[0]),c=e;a.drawEdge(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}})}drawEdge(e,t,r,s,a,i){var o=i("prefix")||"",n=e[o+"size"]||1;a.strokeStyle=s,a.lineWidth=n,a.beginPath(),a.moveTo(t[o+"x"],t[o+"y"]),a.lineTo(r[o+"x"],r[o+"y"]),a.stroke()}},Alvi.UndirectedGraphTracer=class extends Alvi.DirectedGraphTracer{static getClassName(){return"UndirectedGraphTracer"}constructor(e,t){if(super(e,t),this.isNew){var r=this;r.s.settings({defaultEdgeType:"def",funcEdgesDef(e,t,s,a,i){var o=r.getColor(e,t,s,i);r.drawEdge(e,t,s,o,a,i)}})}}setTreeData(e,t){return super.setTreeData(e,t,!0)}setData(e){return super.setData(e,!0)}e(e,t){if(e>t){var r=e;e=t,t=r}return"e"+e+"_"+t}drawOnHover(e,t,r,s){var a=this;t.setLineDash([5,5]);var i=e.id.substring(1);this.graph.edges().forEach(function(o){var n=o.id.substring(1).split("_");if(n[0]==i){var l="#0ff",h=e,c=a.graph.nodes("n"+n[1]);a.drawEdge(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}else if(n[1]==i){var l="#0ff",h=a.graph.nodes("n"+n[0]),c=e;a.drawEdge(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}})}drawEdge(e,t,r,s,a,i){var o=i("prefix")||"",n=e[o+"size"]||1;a.strokeStyle=s,a.lineWidth=n,a.beginPath(),a.moveTo(t[o+"x"],t[o+"y"]),a.lineTo(r[o+"x"],r[o+"y"]),a.stroke()}},Alvi.WeightedDirectedGraphTracer=class extends Alvi.DirectedGraphTracer{static getClassName(){return"WeightedDirectedGraphTracer"}constructor(e,t){if(super(e,t),this.isNew){var r=this;r.s.settings({edgeLabelSize:"proportional",defaultEdgeLabelSize:20,edgeLabelSizePowRatio:.8,funcLabelsDef(e,t,s){r.drawNodeWeight(e,t,s),r.drawLabel(e,t,s)},funcHoversDef(e,t,s){r.drawOnHover(e,t,s,r.drawEdgeWeight)},funcEdgesArrow(e,t,s,a,i){var o=r.getColor(e,t,s,i);r.drawArrow(e,t,s,o,a,i),r.drawEdgeWeight(e,t,s,o,a,i)}})}}_weight(e,t){return this.manager.pushStep(this.capsule,{type:"weight",target:e,weight:t}),this}_visit(e,t,r){return this.manager.pushStep(this.capsule,{type:"visit",target:e,source:t,weight:r}),this}_leave(e,t,r){return this.manager.pushStep(this.capsule,{type:"leave",target:e,source:t,weight:r}),this}processStep(e,t){switch(e.type){case"weight":s=this.graph.nodes(this.n(e.target));void 0!==e.weight&&(s.weight=AVTracerManagerUtil.refineByType(e.weight));break;case"visit":case"leave":var r="visit"==e.type,s=this.graph.nodes(this.n(e.target)),a=r?void 0===e.weight?this.color.selected:this.color.visited:this.color.left;if(s.color=a,void 0!==e.weight&&(s.weight=AVTracerManagerUtil.refineByType(e.weight)),void 0!==e.source){var i=this.e(e.source,e.target),o=this.graph.edges(i);o.color=a,this.graph.dropEdge(i).addEdge(o)}if(this.logTracer){var n=e.source;void 0===n&&(n=""),this.logTracer.print(r?n+" -> "+e.target:n+" <- "+e.target)}break;default:super.processStep(e,t)}}clear(){super.clear(),this.clearWeights()}clearWeights(){this.graph.nodes().forEach(function(e){e.weight=0})}drawEdgeWeight(e,t,r,s,a,i){if(t!=r){var o=i("prefix")||"",n=e[o+"size"]||1;if(!(n<i("edgeLabelThreshold"))){if(0===i("edgeLabelSizePowRatio"))throw'"edgeLabelSizePowRatio" must not be 0.';var l,h=(t[o+"x"]+r[o+"x"])/2,c=(t[o+"y"]+r[o+"y"])/2,d=r[o+"x"]-t[o+"x"],p=r[o+"y"]-t[o+"y"],u=Math.atan2(p,d);l="fixed"===i("edgeLabelSize")?i("defaultEdgeLabelSize"):i("defaultEdgeLabelSize")*n*Math.pow(n,-1/i("edgeLabelSizePowRatio")),a.save(),e.active?(a.font=[i("activeFontStyle"),l+"px",i("activeFont")||i("font")].join(" "),a.fillStyle=s):(a.font=[i("fontStyle"),l+"px",i("font")].join(" "),a.fillStyle=s),a.textAlign="center",a.textBaseline="alphabetic",a.translate(h,c),a.rotate(u),a.fillText(e.weight,0,-n/2-3),a.restore()}}}drawNodeWeight(e,t,r){var s,a=r("prefix")||"",i=e[a+"size"];i<r("labelThreshold")||(s="fixed"===r("labelSize")?r("defaultLabelSize"):r("labelSizeRatio")*i,t.font=(r("fontStyle")?r("fontStyle")+" ":"")+s+"px "+r("font"),t.fillStyle="node"===r("labelColor")?e.color||r("defaultNodeColor"):r("defaultLabelColor"),t.textAlign="left",t.fillText(e.weight,Math.round(e[a+"x"]+1.5*i),Math.round(e[a+"y"]+s/3)))}},Alvi.WeightedUndirectedGraphTracer=class extends Alvi.WeightedDirectedGraphTracer{static getClassName(){return"WeightedUndirectedGraphTracer"}constructor(e,t){if(super(e,t),this.e=UndirectedGraphTracer.prototype.e,this.drawOnHover=UndirectedGraphTracer.prototype.drawOnHover,this.drawEdge=UndirectedGraphTracer.prototype.drawEdge,this.isNew){var r=this;r.s.settings({defaultEdgeType:"def",funcEdgesDef(e,t,s,a,i){var o=r.getColor(e,t,s,i);r.drawEdge(e,t,s,o,a,i),r.drawEdgeWeight(e,t,s,o,a,i)}})}}setTreeData(e,t){return super.setTreeData(e,t,!0)}setData(e){return super.setData(e,!0)}drawEdgeWeight(e,t,r,s,a,i){var o=i("prefix")||"";if(t[o+"x"]>r[o+"x"]){var n=t;t=r,r=n}WeightedDirectedGraphTracer.prototype.drawEdgeWeight.call(this,e,t,r,s,a,i)}},Alvi.DirectedGraphConstructTracer=class extends Alvi.Tracer{static getClassName(){return"DirectedGraphConstructTracer"}constructor(e,t,r=null){if(super(e,t),this.nodePlacement=r,this.nodeCollection=[],this.isNew){var s=this;s.s=s.capsule.s=new sigma({renderer:{container:s.$container[0],type:"canvas"},settings:{minArrowSize:8,defaultEdgeType:"arrow",maxEdgeSize:2.5,labelThreshold:4,font:"Roboto",defaultLabelColor:"#fff",zoomMin:.6,zoomMax:1.2,skipErrors:!0,minNodeSize:.5,maxNodeSize:12,labelSize:"proportional",labelSizeRatio:1.3,funcLabelsDef(e,t,r){s.drawLabel(e,t,r)},funcHoversDef(e,t,r,a){s.drawOnHover(e,t,r,a)},funcEdgesArrow(e,t,r,a,i){var o=s.getColor(e,t,r,i);s.drawArrow(e,t,r,o,a,i)}}}),sigma.plugins.dragNodes(s.s,s.s.renderers[0]),s.graph=s.capsule.graph=s.s.graph}}_addRoot(e){return this.manager.pushStep(this.capsule,{type:"addRoot",arguments:arguments}),this}_addNode(e,t=null){return this.manager.pushStep(this.capsule,{type:"addNode",arguments:arguments}),this}_findNode(e){var t=this.n(e),r=this.nodeCollection,s=null;for(let e=0;e<r.length;e++)if(r[e].id===t){s=r[e];break}return s}_visit(e,t){return this.manager.pushStep(this.capsule,{type:"visit",target:e,source:t}),this}_leave(e,t){return this.manager.pushStep(this.capsule,{type:"leave",target:e,source:t}),this}_setNodePositions(e){return this.manager.pushStep(this.capsule,{type:"setNodePositions",positions:e}),this}_clearTraversal(){return this.manager.pushStep(this.capsule,{type:"clear"}),this}processStep(e,t){switch(e.type){case"clear":this.clear.apply(this);break;case"setNodePositions":$.each(this.graph.nodes(),(t,r)=>{if(t>=e.positions.length)return!1;const s=e.positions[t];r.x=s.x,r.y=s.y});break;case"addRoot":this.addRoot.apply(this,e.arguments);break;case"addNode":this.addNode.apply(this,e.arguments);break;case"visit":case"leave":var r="visit"==e.type,s=this._findNode(e.target);s.visited=r,s.isNew=!1;var a=this.graph.nodes(this.n(e.target)),i=r?this.color.visited:this.color.left;if(a&&(a.color=i,void 0!==e.source)){var o=this.e(e.source,e.target),n=this.graph.edges(o);n.color=i,this.graph.dropEdge(o).addEdge(n)}if(this.logTracer){var l=e.source;void 0===l&&(l=""),this.logTracer.print(r?l+" -> "+e.target:l+" <- "+e.target)}break;default:super.processStep(e,t)}}addRoot(e){if(this.rootObject)throw"Root for this graph is already added";this.rootObject=this.createGraphNode(e),this.drawGraph(this.rootObject.level)}addNode(e,t){var r=this.createGraphNode(e,t);this.drawGraph(r.level)}createGraphNode(e,t){var r=this.nodeConstruct(e),s=this._findNode(t);if(s)if(r.parent=s,r.level=s.level+1,null===this.nodePlacement)s.children.push(r);else if(0===this.nodePlacement){var a=!1,i=0;if(s.children.length>0)for(let t=0;t<s.children.length;t++){if(s.children[t].originalVal>e){a=!0;break}i++}a?s.children.splice(i,0,r):s.children.push(r)}return this.nodeCollection.push(r),r}nodeConstruct(e){return{id:this.n(e),originalVal:e,isNew:!0,visited:!1,children:[],level:1,parent:null}}drawGraph(e){const t=[],r=[];var s=this,a=function(e,t){if(e.children.length>1){var r=Math.floor(e.children.length/2);for(let s=0;s<e.children.length;s++)s===r&&(t+=e.children.length%2==0?1:0,i(e,t)),t=a(e.children[s],t),o(e,e.children[s])}else 0===e.children.length?t+=1:(t=a(e.children[0],t),o(e,e.children[0])),i(e,t);return t},i=function(e,r){var a=n(e.isNew,e.visited,s.color);t.push({id:e.id,label:""+e.originalVal,x:r,y:e.level-1,size:1,color:a,weight:0})},o=function(e,t){var a=n(e.visited&&t.isNew,e.visited&&t.visited,s.color);r.push({id:s.e(e.originalVal,t.originalVal),source:e.id,target:t.id,color:a,size:1,weight:AVTracerManagerUtil.refineByType(t.originalVal)})},n=function(e,t,r){return e?r.selected:t?r.visited:r.default};return a(this.rootObject,0),this.graph.clear(),this.graph.read({nodes:t,edges:r}),this.s.camera.goTo({x:0,y:e,angle:0,ratio:1}),this.refresh(),!1}resize(){super.resize(),this.s.renderers[0].resize(),this.refresh()}refresh(){super.refresh(),this.s.refresh()}clear(){super.clear(),this.clearGraphColor(),this.refresh()}clearGraphColor(){var e=this;this.nodeCollection.forEach(function(e){e.visited=e.isNew=!1}),this.graph.nodes().forEach(function(t){t.color=e.color.default}),this.graph.edges().forEach(function(t){t.color=e.color.default})}n(e){return"n"+e}e(e,t){return"e"+e+"_"+t}getColor(e,t,r,s){var a=e.color,i=s("edgeColor"),o=s("defaultNodeColor"),n=s("defaultEdgeColor");if(!a)switch(i){case"source":a=t.color||o;break;case"target":a=r.color||o;break;default:a=n}return a}drawLabel(e,t,r){var s,a=r("prefix")||"",i=e[a+"size"];i<r("labelThreshold")||e.label&&"string"==typeof e.label&&(s="fixed"===r("labelSize")?r("defaultLabelSize"):r("labelSizeRatio")*i,t.font=(r("fontStyle")?r("fontStyle")+" ":"")+s+"px "+r("font"),t.fillStyle="node"===r("labelColor")?e.color||r("defaultNodeColor"):r("defaultLabelColor"),t.textAlign="center",t.fillText(e.label,Math.round(e[a+"x"]),Math.round(e[a+"y"]+s/3)))}drawArrow(e,t,r,s,a,i){var o=i("prefix")||"",n=e[o+"size"]||1,l=r[o+"size"],h=t[o+"x"],c=t[o+"y"],d=r[o+"x"],p=r[o+"y"],u=Math.atan2(p-c,d-h);h+=3*Math.sin(u),d+=3*Math.sin(u),c+=3*-Math.cos(u),p+=3*-Math.cos(u);var g=Math.max(2.5*n,i("minArrowSize")),f=Math.sqrt(Math.pow(d-h,2)+Math.pow(p-c,2)),v=h+(d-h)*(f-g-l)/f,m=c+(p-c)*(f-g-l)/f,w=(d-h)*g/f,y=(p-c)*g/f;a.strokeStyle=s,a.lineWidth=n,a.beginPath(),a.moveTo(h,c),a.lineTo(v,m),a.stroke(),a.fillStyle=s,a.beginPath(),a.moveTo(v+w,m+y),a.lineTo(v+.6*y,m-.6*w),a.lineTo(v-.6*y,m+.6*w),a.lineTo(v+w,m+y),a.closePath(),a.fill()}drawOnHover(e,t,r,s){var a=this;t.setLineDash([5,5]);var i=e.id.substring(1);this.graph.edges().forEach(function(o){var n=o.id.substring(1).split("_");if(n[0]==i){var l="#0ff",h=e,c=a.graph.nodes("n"+n[1]);a.drawArrow(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}else if(n[1]==i){var l="#ff0",h=a.graph.nodes("n"+n[0]),c=e;a.drawArrow(o,h,c,l,t,r),s&&s(o,h,c,l,t,r)}})}},Alvi.LogTracer=class extends Alvi.Tracer{static getClassName(){return"LogTracer"}constructor(e,t){if(super(e,t),this.isNew){var r=this;r.$wrapper=r.capsule.$wrapper=$('<div class="av-wrapper">'),r.$container.append(r.$wrapper)}}_print(e){return this.manager.pushStep(this.capsule,{type:"print",msg:e}),this}processStep(e,t){switch(e.type){case"print":this.print(e.msg)}}refresh(){this.scrollToEnd(Math.min(50,this.interval))}clear(){super.clear(),this.$wrapper.empty()}print(e){this.$wrapper.append($("<span>").append(e+"<br/>"))}scrollToEnd(e){this.$container.animate({scrollTop:this.$container[0].scrollHeight},e)}};var AVTracerManagerUtil={refineByType:e=>{switch(typeof e){case"number":return e===1/0?"∞":e;case"boolean":return e?"T":"F";default:return""===e?" ":e}},fromJSON:e=>JSON.parse(e,(e,t)=>"Infinity"===t?1/0:t),toJSON:e=>JSON.stringify(e,(e,t)=>t===1/0?"Infinity":t)};sigma.canvas.labels.def=function(e,t,r){var s=r("funcLabelsDef");s&&s(e,t,r)},sigma.canvas.hovers.def=function(e,t,r){var s=r("funcHoversDef");s&&s(e,t,r)},sigma.canvas.edges.def=function(e,t,r,s,a){var i=a("funcEdgesDef");i&&i(e,t,r,s,a)},sigma.canvas.edges.arrow=function(e,t,r,s,a){var i=a("funcEdgesArrow");i&&i(e,t,r,s,a)};